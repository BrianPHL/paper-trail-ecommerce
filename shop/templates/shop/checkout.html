{% load static %}

<!DOCTYPE html>
<html data-theme="light" lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Checkout | Paper Trails</title>
    <link rel="stylesheet" href="{% static 'shop/styles/main.css' %}">
</head>
<body>

    {% include "./components/header.html" %}

    <main class="checkout-wrapper">
        <div class="checkout-container">

            <h1 class="checkout-header">Checkout</h1>

            <div class="checkout-summary">
                <h2>Order Summary</h2>
                <ul>
                    {% for item in items %}
                    <li class="checkout-item">
                        <div class="checkout-item-left">
                            <img 
                                src="{% if item.product.image %}{{ item.product.image.url }}{% else %}{% static 'shop/images/placeholder.png' %}{% endif %}" 
                                alt="{{ item.product.name }}" 
                                class="checkout-item-image"
                            >
                            <div class="checkout-item-info">
                                <div class="checkout-item-name">{{ item.product.name }}</div>
                                <div class="checkout-item-qty">Qty: {{ item.quantity }}</div>
                            </div>
                        </div>
                        <div class="checkout-item-price">
                            PHP {{ item.total_price|floatformat:2 }}
                        </div>
                    </li>
                    {% endfor %}
                </ul>

                <div class="checkout-totals">
                    <div class="horizontal-divider"></div>
                    <div class="checkout-total-row">
                        <span>Subtotal</span>
                        <span>PHP {{ cart.total_price|floatformat:2 }}</span>
                    </div>
                    <div class="checkout-total-row">
                        <span>Shipping fee</span>
                        <span>PHP {% if shipping_fee %}{{ shipping_fee|floatformat:2 }}{% else %}0.00{% endif %}</span>
                    </div>
                    <div class="horizontal-divider"></div>
                    <div class="checkout-total-row grand-total">
                        <span>Total</span>
                        <span>
                            PHP
                            {% if shipping_fee %}
                                {{ cart.total_price|add:shipping_fee|floatformat:2 }}
                            {% else %}
                                {{ cart.total_price|floatformat:2 }}
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>

            <form method="post" class="checkout-form">
                {% csrf_token %}
                <h2>Delivery Details</h2>
                <div class="checkout-form-fields">
                    <div class="checkout-form-field">
                        <label for="full_name">Full Name</label>
                        <input type="text" id="full_name" name="full_name" value="{{ user.profile.get_user_full_name|default:user.username }}" required>
                    </div>
                    <div class="checkout-form-field">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" value="{{ user.email|default:user.username }}" required>
                    </div>
                    <div class="checkout-form-field">
                        <label for="address">Address</label>
                        <input type="text" id="address" name="address" required>
                    </div>
                </div>
                
                <div class="checkout-payment-section">
                    <h2>Mode of Payment</h2>
                    <label class="input-radio">
                        <input type="radio" id="cod" name="payment_method" value="COD" checked required>
                        Cash on Delivery (COD)
                    </label>
                </div>
                
                <button type="submit" class="button-primary checkout-submit">
                    Place Order
                    <i class="fa-solid fa-box"></i>
                </button>
            </form>
        </div>
    </main>

    {% include "./components/footer.html" %}

    <script type="module" src="{% static 'shop/scripts/main.js' %}"></script>
</body>
</html>
