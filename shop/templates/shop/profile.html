{% load static %}
<!DOCTYPE html>
<html data-theme="light" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile | Paper Trails</title>
    <link rel="stylesheet" href="{% static 'shop/styles/main.css' %}">
    <link rel="stylesheet" href="{% static 'shop/styles/pages/_profile.css' %}">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="{% static 'shop/styles/vendors/_font-awesome.css' %}">
</head>
<body style="min-height: 100vh; display: flex; flex-direction: column;">
    {% include "./components/header.html" %}

    <div style="flex: 1; background: var(--bg-primary);">
        <main class="profile-main-wrapper">
            <!-- Profile Header -->
            <h1 class="profile-title">My Profile</h1>
            
            <!-- Main Profile Layout -->
            <div class="profile-layout">
                <!-- Left Sidebar - Avatar Section -->
                <div class="profile-sidebar">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar">
                            {% if user_profile and user_profile.profile_picture %}
                                <img src="{{ user_profile.profile_picture.url }}" alt="Profile Picture" />
                            {% else %}
                                <div class="avatar-placeholder">
                                    <span class="avatar-initial">{{ user.first_name.0|default:user.username.0|upper }}</span>
                                </div>
                            {% endif %}
                            <button class="avatar-edit-btn" id="avatar-edit-btn" title="Click to change profile picture">
                                <i class="fa-solid fa-pencil"></i>
                            </button>
                        </div>
                        
                        <form method="POST" enctype="multipart/form-data" id="avatar-form" style="display: none;">
                            {% csrf_token %}
                            <input type="file" name="profile_picture" accept="image/*" id="profile-picture-input">
                        </form>
                    </div>
                    
                    <div class="profile-info">
                        <h2 class="profile-name">{{ user.first_name|default:user.username }} {{ user.last_name }}</h2>
                        <p class="profile-email">{{ user.email }}</p>
                        <div class="profile-meta">
                            <p><small>Member since: {{ user.date_joined|date:"Y-m-d H:i" }}</small></p>
                            <p><small>Last modified since: {{ user.last_login|date:"Y-m-d H:i"|default:"Never" }}</small></p>
                        </div>
                    </div>
                </div>

                <!-- Right Content Area -->
                <div class="profile-content">
                    <!-- Warning Alert -->
                    <div class="alert-warning">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <span>Please double-check all information before saving. Changes will permanently replace your existing profile data and can no longer be restored.</span>
                    </div>

            <!-- Personal Information Section -->
            <div class="profile-section">
                <h3 class="section-title">Personal Information</h3>
                <form method="POST" id="personal-info-form">
                    {% csrf_token %}
                    <input type="hidden" name="update_personal_info" value="1">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>First name</label>
                            <input type="text" value="{{ user.first_name }}" readonly class="form-input" name="first_name" id="first_name">
                        </div>
                        <div class="form-group">
                            <label>Last name</label>
                            <input type="text" value="{{ user.last_name }}" readonly class="form-input" name="last_name" id="last_name">
                        </div>
                        <div class="form-group">
                            <label>Email address</label>
                            <input type="email" value="{{ user.email }}" readonly class="form-input" name="email" id="email">
                        </div>
                        <div class="form-group">
                            <label>Phone number</label>
                            <input type="text" value="{{ user_profile.contact_number|default:'' }}" readonly class="form-input" name="contact_number" id="contact_number">
                        </div>
                    </div>
                    <div class="section-actions">
                        <button type="button" class="btn-secondary" id="edit-personal-info">
                            <i class="fa-solid fa-pencil"></i> Update personal info
                        </button>
                        <button type="button" class="btn-outline" id="reset-personal-info" style="display: none;">Reset</button>
                    </div>
                </form>
            </div>

            <!-- Settings removed: site now supports only PHP + COD -->

            <!-- Address Book Section -->
            <div class="profile-section">
                <div class="section-header">
                    <h3 class="section-title">Address Book</h3>
                    <button type="button" class="btn-add" id="add-address-btn">
                        <i class="fa-solid fa-plus"></i> Add new address
                    </button>
                </div>
                
                <!-- Add Address Form (Initially Hidden) -->
                <div id="add-address-form-container" class="address-form-container" style="display: none;">
                    <div class="form-header">
                        <h4>Add New Address</h4>
                        <button type="button" class="btn-outline" id="cancel-add-address">Cancel</button>
                    </div>
                    <form method="POST" action="{% url 'add_address' %}" class="inline-address-form">
                        {% csrf_token %}
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="add-label">Address Label *</label>
                                <input type="text" id="add-label" name="label" class="form-input" placeholder="e.g., Home, Work" required>
                            </div>
                            <div class="form-group">
                                <label for="add-address-type">Address Type</label>
                                <select id="add-address-type" name="address_type" class="form-input">
                                    <option value="home">Home</option>
                                    <option value="work">Work</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="add-street-address">Street Address *</label>
                            <input type="text" id="add-street-address" name="street_address" class="form-input" placeholder="Street address" required>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="add-city">City *</label>
                                <input type="text" id="add-city" name="city" class="form-input" placeholder="City" required>
                            </div>
                            <div class="form-group">
                                <label for="add-state-province">State/Province *</label>
                                <input type="text" id="add-state-province" name="state_province" class="form-input" placeholder="State/Province" required>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="add-postal-code">Postal Code *</label>
                                <input type="text" id="add-postal-code" name="postal_code" class="form-input" placeholder="Postal code" required>
                            </div>
                            <div class="form-group">
                                <label for="add-country">Country</label>
                                <select id="add-country" name="country" class="form-input">
                                    <option value="Philippines" selected>Philippines</option>
                                    <option value="United States">United States</option>
                                    <option value="Canada">Canada</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Japan">Japan</option>
                                    <option value="South Korea">South Korea</option>
                                    <option value="Singapore">Singapore</option>
                                    <option value="Malaysia">Malaysia</option>
                                    <option value="Thailand">Thailand</option>
                                    <option value="Indonesia">Indonesia</option>
                                    <option value="Vietnam">Vietnam</option>
                                    <option value="India">India</option>
                                    <option value="China">China</option>
                                    <option value="Hong Kong">Hong Kong</option>
                                    <option value="Taiwan">Taiwan</option>
                                    <option value="Germany">Germany</option>
                                    <option value="France">France</option>
                                    <option value="Italy">Italy</option>
                                    <option value="Spain">Spain</option>
                                    <option value="Netherlands">Netherlands</option>
                                    <option value="Belgium">Belgium</option>
                                    <option value="Switzerland">Switzerland</option>
                                    <option value="Austria">Austria</option>
                                    <option value="Sweden">Sweden</option>
                                    <option value="Norway">Norway</option>
                                    <option value="Denmark">Denmark</option>
                                    <option value="Finland">Finland</option>
                                    <option value="Brazil">Brazil</option>
                                    <option value="Mexico">Mexico</option>
                                    <option value="Argentina">Argentina</option>
                                    <option value="Chile">Chile</option>
                                    <option value="Colombia">Colombia</option>
                                    <option value="Peru">Peru</option>
                                    <option value="New Zealand">New Zealand</option>
                                    <option value="South Africa">South Africa</option>
                                    <option value="United Arab Emirates">United Arab Emirates</option>
                                    <option value="Saudi Arabia">Saudi Arabia</option>
                                    <option value="Israel">Israel</option>
                                    <option value="Turkey">Turkey</option>
                                    <option value="Russia">Russia</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="is_default" id="add-is-default">
                                Set as default address
                            </label>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Add Address</button>
                        </div>
                    </form>
                </div>

                <!-- Edit Address Form (Initially Hidden) -->
                <div id="edit-address-form-container" class="address-form-container" style="display: none;">
                    <div class="form-header">
                        <h4>Edit Address</h4>
                        <button type="button" class="btn-outline" id="cancel-edit-address">Cancel</button>
                    </div>
                    <form method="POST" id="edit-address-form" class="inline-address-form">
                        {% csrf_token %}
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="edit-label">Address Label *</label>
                                <input type="text" id="edit-label" name="label" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="edit-address-type">Address Type</label>
                                <select id="edit-address-type" name="address_type" class="form-input">
                                    <option value="home">Home</option>
                                    <option value="work">Work</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="edit-street-address">Street Address *</label>
                            <input type="text" id="edit-street-address" name="street_address" class="form-input" required>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="edit-city">City *</label>
                                <input type="text" id="edit-city" name="city" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="edit-state-province">State/Province *</label>
                                <input type="text" id="edit-state-province" name="state_province" class="form-input" required>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="edit-postal-code">Postal Code *</label>
                                <input type="text" id="edit-postal-code" name="postal_code" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label for="edit-country">Country</label>
                                <select id="edit-country" name="country" class="form-input">
                                    <option value="Philippines">Philippines</option>
                                    <option value="United States">United States</option>
                                    <option value="Canada">Canada</option>
                                    <option value="United Kingdom">United Kingdom</option>
                                    <option value="Australia">Australia</option>
                                    <option value="Japan">Japan</option>
                                    <option value="South Korea">South Korea</option>
                                    <option value="Singapore">Singapore</option>
                                    <option value="Malaysia">Malaysia</option>
                                    <option value="Thailand">Thailand</option>
                                    <option value="Indonesia">Indonesia</option>
                                    <option value="Vietnam">Vietnam</option>
                                    <option value="India">India</option>
                                    <option value="China">China</option>
                                    <option value="Hong Kong">Hong Kong</option>
                                    <option value="Taiwan">Taiwan</option>
                                    <option value="Germany">Germany</option>
                                    <option value="France">France</option>
                                    <option value="Italy">Italy</option>
                                    <option value="Spain">Spain</option>
                                    <option value="Netherlands">Netherlands</option>
                                    <option value="Belgium">Belgium</option>
                                    <option value="Switzerland">Switzerland</option>
                                    <option value="Austria">Austria</option>
                                    <option value="Sweden">Sweden</option>
                                    <option value="Norway">Norway</option>
                                    <option value="Denmark">Denmark</option>
                                    <option value="Finland">Finland</option>
                                    <option value="Brazil">Brazil</option>
                                    <option value="Mexico">Mexico</option>
                                    <option value="Argentina">Argentina</option>
                                    <option value="Chile">Chile</option>
                                    <option value="Colombia">Colombia</option>
                                    <option value="Peru">Peru</option>
                                    <option value="New Zealand">New Zealand</option>
                                    <option value="South Africa">South Africa</option>
                                    <option value="United Arab Emirates">United Arab Emirates</option>
                                    <option value="Saudi Arabia">Saudi Arabia</option>
                                    <option value="Israel">Israel</option>
                                    <option value="Turkey">Turkey</option>
                                    <option value="Russia">Russia</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="is_default" id="edit-is-default">
                                Set as default address
                            </label>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Update Address</button>
                        </div>
                    </form>
                </div>

                <div class="address-list">
                    {% if user_addresses %}
                        {% for address in user_addresses %}
                            <div class="address-item" data-address-id="{{ address.id }}">
                                <div class="address-info">
                                    <div class="address-header">
                                        <h4>{{ address.label }}</h4>
                                        {% if address.is_default %}
                                            <span class="default-badge">Default</span>
                                        {% endif %}
                                        <span class="address-type">{{ address.get_address_type_display }}</span>
                                    </div>
                                    <p class="address-text">{{ address.full_address }}</p>
                                </div>
                                <div class="address-actions">
                                    <button class="btn-icon edit-address-btn" title="Edit" data-address-id="{{ address.id }}">
                                        <i class="fa-solid fa-pencil"></i>
                                    </button>
                                    <button class="btn-icon delete-address-btn" title="Delete" data-address-id="{{ address.id }}">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="empty-state">No addresses added yet.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Account Settings Section -->
            <div class="profile-section">
                <h3 class="section-title">Account Settings</h3>
                <div class="account-settings">
                    <div class="setting-item">
                        <div class="setting-content">
                            <h4>Change Password</h4>
                            <p>Update your account password to keep your account secure.</p>
                        </div>
                        <button type="button" class="btn-secondary" id="change-password-btn">
                            <i class="fa-solid fa-key"></i> Change Password
                        </button>
                    </div>
                    
                    <!-- Change Password Form (Initially Hidden) -->
                    <div id="change-password-form-container" class="password-form-container" style="display: none;">
                        <h4>Change Password</h4>
                        <form method="POST" action="{% url 'change_password' %}" class="inline-password-form">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="current-password">Current Password *</label>
                                <input type="password" id="current-password" name="current_password" class="form-input" placeholder="Enter your current password" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password *</label>
                                <input type="password" id="new-password" name="new_password" class="form-input" placeholder="Enter your new password" required>
                                <small class="form-help">Password must be at least 8 characters long.</small>
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Confirm New Password *</label>
                                <input type="password" id="confirm-password" name="confirm_password" class="form-input" placeholder="Confirm your new password" required>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Update Password</button>
                            </div>
                        </form>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <div class="setting-item">
                        <div class="setting-content">
                            <h4>Sign Out</h4>
                            <p>Ready to leave? Sign out to protect your account. You'll need to log in again for your next visit.</p>
                        </div>
                        <form action="{% url 'logout' %}" method="POST" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn-secondary">
                                <i class="fa-solid fa-sign-out-alt"></i> Sign out of my account
                            </button>
                        </form>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <div class="setting-item danger-zone">
                        <div class="setting-content">
                            <h4>Delete Account</h4>
                            <p>This will permanently delete your account and all associated data. You will lose access to your profile, reservation history, and saved payment methods. This action cannot be reversed.</p>
                        </div>
                        <button type="button" class="btn-danger" id="delete-account-btn">
                            <i class="fa-solid fa-trash"></i> Delete my account
                        </button>
                    </div>
                    
                    <!-- Delete Account Confirmation Modal -->
                    <div id="delete-account-modal" class="modal-overlay" style="display: none;">
                        <div class="simple-modal">
                            <h3>Delete Account</h3>
                            <p>Are you sure you want to delete your account? This action cannot be undone.</p>
                            
                            <form id="delete-account-form" method="POST" action="{% url 'delete_account' %}">
                                {% csrf_token %}
                                <div class="form-group">
                                    <input type="password" id="password-confirmation" name="password_confirmation" 
                                           class="form-input" placeholder="Enter your password to confirm" required>
                                </div>
                                
                                <div class="modal-actions">
                                    <button type="button" class="btn-secondary" id="cancel-delete">Cancel</button>
                                    <button type="submit" class="btn-danger" id="confirm-delete">Delete Account</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            </div> <!-- End profile-content -->
        </div> <!-- End profile-layout -->

            <!-- Hidden Forms -->
            <form id="profile-update-form" method="POST" enctype="multipart/form-data" style="display: none;">
                {% csrf_token %}
                <input type="hidden" name="house_address" value="{{ user_profile.house_address }}">
            </form>
        </main>
    </div>
    <footer style="width: 100%; display: flex; flex-direction: column; margin-top: auto;">
        {% include "./components/footer.html" %}
    </footer>


    <!-- Main JS for dark mode and interactivity -->
    <script type="module" src="{% static 'shop/scripts/main.js' %}"></script>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    // Avatar upload functionality
    const avatarEditBtn = document.getElementById('avatar-edit-btn');
    const profilePictureInput = document.getElementById('profile-picture-input');
    const avatarForm = document.getElementById('avatar-form');

    if (avatarEditBtn && profilePictureInput && avatarForm) {
        avatarEditBtn.addEventListener('click', function() {
            profilePictureInput.click();
        });

        profilePictureInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                avatarForm.submit();
            }
        });
    }

    // Personal info editing
    const editPersonalInfoBtn = document.getElementById('edit-personal-info');
    const resetPersonalInfoBtn = document.getElementById('reset-personal-info');
    const personalInfoInputs = document.querySelectorAll('#personal-info-form .form-input');
    const personalInfoForm = document.getElementById('personal-info-form');
    
    let originalValues = {};
    let isEditing = false;
    
    // Store original values
    personalInfoInputs.forEach(input => {
        originalValues[input.name] = input.value;
    });
    
    if (editPersonalInfoBtn) {
        editPersonalInfoBtn.addEventListener('click', function() {
            if (!isEditing) {
                // Enable editing mode
                personalInfoInputs.forEach(input => {
                    input.readOnly = false;
                    input.classList.remove('form-input');
                    input.classList.add('form-input-editable');
                });
                
                // Change button to save
                editPersonalInfoBtn.innerHTML = '<i class="fa-solid fa-save"></i> Save changes';
                editPersonalInfoBtn.classList.remove('btn-secondary');
                editPersonalInfoBtn.classList.add('btn-primary');
                resetPersonalInfoBtn.style.display = 'inline-flex';
                
                isEditing = true;
            } else {
                // Submit the form
                personalInfoForm.submit();
            }
        });
    }
    
    if (resetPersonalInfoBtn) {
        resetPersonalInfoBtn.addEventListener('click', function() {
            // Reset to original values
            personalInfoInputs.forEach(input => {
                input.value = originalValues[input.name];
                input.readOnly = true;
                input.classList.remove('form-input-editable');
                input.classList.add('form-input');
            });
            
            // Reset button states
            editPersonalInfoBtn.innerHTML = '<i class="fa-solid fa-pencil"></i> Update personal info';
            editPersonalInfoBtn.classList.remove('btn-primary');
            editPersonalInfoBtn.classList.add('btn-secondary');
            resetPersonalInfoBtn.style.display = 'none';
            
            isEditing = false;
        });
    }

    // Delete account functionality
    const deleteAccountBtn = document.getElementById('delete-account-btn');
    const deleteAccountModal = document.getElementById('delete-account-modal');
    const cancelDelete = document.getElementById('cancel-delete');
    const confirmDeleteBtn = document.getElementById('confirm-delete');
    
    if (deleteAccountBtn && deleteAccountModal) {
        // Show delete modal
        deleteAccountBtn.addEventListener('click', function() {
            deleteAccountModal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            document.body.classList.add('modal-open');
            
            // Clear form fields
            document.getElementById('password-confirmation').value = '';
        });
        
        // Close modal function
        function closeDeleteAccountModal() {
            deleteAccountModal.style.display = 'none';
            document.body.style.overflow = 'auto';
            document.body.classList.remove('modal-open');
        }
        
        // Cancel button
        cancelDelete.addEventListener('click', closeDeleteAccountModal);
        
        // Close modal when clicking outside
        deleteAccountModal.addEventListener('click', function(e) {
            if (e.target === deleteAccountModal) {
                closeDeleteAccountModal();
            }
        });
        
        // Form submission with confirmation
        const deleteForm = document.getElementById('delete-account-form');
        if (deleteForm) {
            deleteForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (confirm('Are you sure? This will permanently delete your account and cannot be undone.')) {
                    this.submit();
                }
            });
        }
    }

    // Settings removed: no client-side handlers needed (site locked to PHP + COD)

    // Change password functionality
    const changePasswordBtn = document.getElementById('change-password-btn');
    const changePasswordFormContainer = document.getElementById('change-password-form-container');
    
    if (changePasswordBtn && changePasswordFormContainer) {
        changePasswordBtn.addEventListener('click', function() {
            // Hide address forms if visible
            if (addAddressFormContainer) {
                addAddressFormContainer.style.display = 'none';
                addAddressBtn.innerHTML = '<i class="fa-solid fa-plus"></i> Add new address';
                addAddressBtn.classList.remove('btn-outline');
                addAddressBtn.classList.add('btn-add');
            }
            if (editAddressFormContainer) {
                editAddressFormContainer.style.display = 'none';
            }
            
            // Toggle password form
            if (changePasswordFormContainer.style.display === 'none' || changePasswordFormContainer.style.display === '') {
                changePasswordFormContainer.style.display = 'block';
                changePasswordBtn.innerHTML = '<i class="fa-solid fa-minus"></i> Cancel';
                changePasswordBtn.classList.remove('btn-secondary');
                changePasswordBtn.classList.add('btn-outline');
                
                // Clear form fields
                document.getElementById('current-password').value = '';
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-password').value = '';
                
                // Scroll to the button instead of the form for better visibility
                changePasswordBtn.scrollIntoView({ behavior: 'smooth', block: 'center' });
            } else {
                changePasswordFormContainer.style.display = 'none';
                changePasswordBtn.innerHTML = '<i class="fa-solid fa-key"></i> Change Password';
                changePasswordBtn.classList.remove('btn-outline');
                changePasswordBtn.classList.add('btn-secondary');
            }
        });
        
        // Password confirmation validation
        const newPasswordInput = document.getElementById('new-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        
        if (newPasswordInput && confirmPasswordInput) {
            function validatePasswordMatch() {
                if (confirmPasswordInput.value && newPasswordInput.value !== confirmPasswordInput.value) {
                    confirmPasswordInput.setCustomValidity('Passwords do not match');
                } else {
                    confirmPasswordInput.setCustomValidity('');
                }
            }
            
            newPasswordInput.addEventListener('input', validatePasswordMatch);
            confirmPasswordInput.addEventListener('input', validatePasswordMatch);
        }
    }

    // Address Book functionality
    const addAddressBtn = document.getElementById('add-address-btn');
    const addAddressFormContainer = document.getElementById('add-address-form-container');
    const editAddressFormContainer = document.getElementById('edit-address-form-container');
    const editAddressForm = document.getElementById('edit-address-form');
    const addressList = document.querySelector('.address-list');
    
    // Add address form toggle
    if (addAddressBtn && addAddressFormContainer) {
        addAddressBtn.addEventListener('click', function() {
            // Hide edit form if visible
            if (editAddressFormContainer) {
                editAddressFormContainer.style.display = 'none';
            }
            
            // Toggle add form
            if (addAddressFormContainer.style.display === 'none' || addAddressFormContainer.style.display === '') {
                addAddressFormContainer.style.display = 'block';
                addAddressBtn.innerHTML = '<i class="fa-solid fa-minus"></i> Cancel';
                addAddressBtn.classList.remove('btn-add');
                addAddressBtn.classList.add('btn-outline');
            } else {
                addAddressFormContainer.style.display = 'none';
                addAddressBtn.innerHTML = '<i class="fa-solid fa-plus"></i> Add new address';
                addAddressBtn.classList.remove('btn-outline');
                addAddressBtn.classList.add('btn-add');
            }
        });
        
        // Cancel add address
        document.getElementById('cancel-add-address').addEventListener('click', function() {
            addAddressFormContainer.style.display = 'none';
            addAddressBtn.innerHTML = '<i class="fa-solid fa-plus"></i> Add new address';
            addAddressBtn.classList.remove('btn-outline');
            addAddressBtn.classList.add('btn-add');
        });
    }
    
    // Edit address functionality
    const editAddressBtns = document.querySelectorAll('.edit-address-btn');
    editAddressBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const addressId = this.getAttribute('data-address-id');
            const addressItem = document.querySelector(`[data-address-id="${addressId}"]`);
            
            if (editAddressFormContainer && editAddressForm && addressItem) {
                // Hide add form if visible
                if (addAddressFormContainer) {
                    addAddressFormContainer.style.display = 'none';
                    addAddressBtn.innerHTML = '<i class="fa-solid fa-plus"></i> Add new address';
                    addAddressBtn.classList.remove('btn-outline');
                    addAddressBtn.classList.add('btn-add');
                }
                
                // Set form action URL
                editAddressForm.action = `/profile/address/edit/${addressId}/`;
                
                // Get address data from the address item (you would typically get this from server)
                // For now, we'll clear the form since we need to fetch the data
                editAddressForm.reset();
                
                // Show edit form
                editAddressFormContainer.style.display = 'block';
                
                // Scroll to form
                editAddressFormContainer.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });
    
    // Cancel edit address
    if (editAddressFormContainer) {
        document.getElementById('cancel-edit-address').addEventListener('click', function() {
            editAddressFormContainer.style.display = 'none';
        });
    }
    
    // Delete address functionality
    const deleteAddressBtns = document.querySelectorAll('.delete-address-btn');
    deleteAddressBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const addressId = this.getAttribute('data-address-id');
            
            if (confirm('Are you sure you want to delete this address?')) {
                // Create and submit a form for deletion
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = `/profile/address/delete/${addressId}/`;
                
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrfmiddlewaretoken';
                csrfInput.value = csrfToken;
                
                form.appendChild(csrfInput);
                document.body.appendChild(form);
                form.submit();
            }
        });
    });
});
</script>

</body>
</html>

