{% extends "admin/base_site.html" %}
{% load static %}

{% block content %}
<h1>{{ title }}</h1>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
    <div style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0 0 10px 0; color: #417690;">Total Inventory Value</h3>
        <p style="font-size: 24px; font-weight: bold; margin: 0; color: #417690;">PHP {{ total_inventory_value|floatformat:2 }}</p>
    </div>
    
    <div style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0 0 10px 0; color: #d9534f;">Out of Stock</h3>
        <p style="font-size: 24px; font-weight: bold; margin: 0; color: #d9534f;">{{ out_of_stock_count }}</p>
    </div>
    
    <div style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
        <h3 style="margin: 0 0 10px 0; color: #f0ad4e;">Needs Restock</h3>
        <p style="font-size: 24px; font-weight: bold; margin: 0; color: #f0ad4e;">{{ products_needing_restock }}</p>
    </div>
</div>

<div style="background: #fff; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h2>Low Stock Alert</h2>
    {% if low_stock_products %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f0f0f0;">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Product</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Category</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Current Stock</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Status</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for product in low_stock_products %}
            <tr>
                <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ product.name }}</td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">{{ product.get_category_display_name }}</td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">
                    <span style="font-weight: bold; color: {% if product.stock_quantity == 0 %}red{% elif product.stock_quantity <= 2 %}orange{% else %}#f0ad4e{% endif %};">
                        {{ product.stock_quantity }}
                    </span>
                </td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">{{ product.stock_status }}</td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">
                    <a href="{% url 'admin:shop_product_change' product.id %}" style="color: #417690; text-decoration: none;">Edit</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #5cb85c; font-weight: bold;">âœ“ All products have adequate stock levels</p>
    {% endif %}
</div>

<div style="background: #fff; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h2>Stock Movement (Last 30 Days)</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f0f0f0;">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Transaction Type</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Total Quantity</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Transactions</th>
            </tr>
        </thead>
        <tbody>
            {% for movement in stock_movement %}
            <tr>
                <td style="padding: 12px; border-bottom: 1px solid #eee; text-transform: capitalize;">{{ movement.transaction_type }}</td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee; font-weight: bold; color: {% if movement.total_quantity < 0 %}red{% else %}green{% endif %};">
                    {{ movement.total_quantity|stringformat:"+d" }}
                </td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">{{ movement.transaction_count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="background: #fff; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
    <h2>Recent Inventory Transactions</h2>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f0f0f0;">
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Date & Time</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Product</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Type</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Qty Change</th>
                <th style="padding: 12px; text-align: center; border-bottom: 2px solid #ddd;">Stock After</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Order/Notes</th>
            </tr>
        </thead>
        <tbody>
            {% for trans in recent_transactions %}
            <tr>
                <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ trans.created_at|date:"Y-m-d H:i" }}</td>
                <td style="padding: 12px; border-bottom: 1px solid #eee;">{{ trans.product.name }}</td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee; text-transform: capitalize;">{{ trans.transaction_type }}</td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee; font-weight: bold; color: {% if trans.quantity_change < 0 %}red{% else %}green{% endif %};">
                    {{ trans.quantity_change|stringformat:"+d" }}
                </td>
                <td style="padding: 12px; text-align: center; border-bottom: 1px solid #eee;">{{ trans.stock_after }}</td>
                <td style="padding: 12px; border-bottom: 1px solid #eee;">
                    {% if trans.order %}
                        <a href="{% url 'admin:shop_order_change' trans.order.id %}">Order #{{ trans.order.id }}</a>
                    {% else %}
                        {{ trans.notes|truncatewords:10 }}
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin: 20px 0;">
    <a href="{% url 'admin:shop_inventorytransaction_changelist' %}" class="button" style="background: #417690; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; display: inline-block;">View All Transactions</a>
    <a href="{% url 'admin:index' %}" class="button" style="background: #ddd; color: #333; padding: 10px 20px; text-decoration: none; border-radius: 4px; display: inline-block; margin-left: 10px;">Back to Admin</a>
</div>

{% endblock %}
