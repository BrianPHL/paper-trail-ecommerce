{% extends "admin/base_site.html" %}

{% load static %}

{% block extrastyle %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'shop/styles/admin/admin_custom.css' %}">
{% endblock %}

{% block content %}
<div class="module">
    <h2>Sales Analytics Dashboard</h2>
    
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div style="flex: 1; padding: 10px; border: 1px solid #ddd;">
            <h3>Total Orders</h3>
            <p style="font-size: 24px; font-weight: bold;">{{ total_orders }}</p>
        </div>
        <div style="flex: 1; padding: 10px; border: 1px solid #ddd;">
            <h3>Total Revenue</h3>
            <p style="font-size: 24px; font-weight: bold;">PHP {{ total_revenue|floatformat:2 }}</p>
        </div>
        <div style="flex: 1; padding: 10px; border: 1px solid #ddd;">
            <h3>Completed Orders</h3>
            <p style="font-size: 24px; font-weight: bold;">{{ completed_orders }}</p>
        </div>
    </div>
    
    <h3>Order Status Breakdown</h3>
    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
        <div style="flex: 1; padding: 10px; border: 1px solid #ddd;">
            <h4>Pending</h4>
            <p style="font-size: 24px; font-weight: bold;">{{ pending_orders }}</p>
        </div>
        <div style="flex: 1; padding: 10px; border: 1px solid #ddd;">
            <h4>Completed</h4>
            <p style="font-size: 24px; font-weight: bold;">{{ completed_orders }}</p>
        </div>
        <div style="flex: 1; padding: 10px; border: 1px solid #ddd;">
            <h4>Cancelled</h4>
            <p style="font-size: 24px; font-weight: bold;">{{ cancelled_orders }}</p>
        </div>
    </div>
    
    <h3>Top 10 Products</h3>
    <canvas id="topProductsChart" width="400" height="200"></canvas>
    
    <h3>Monthly Sales (Last 12 Months)</h3>
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #f5f5f5;">
                <th style="border: 1px solid #ddd; padding: 8px;">Month</th>
                <th style="border: 1px solid #ddd; padding: 8px;">Orders</th>
                <th style="border: 1px solid #ddd; padding: 8px;">Revenue</th>
            </tr>
        </thead>
        <tbody>
            {% for month in monthly_sales %}
            <tr>
                <td style="border: 1px solid #ddd; padding: 8px;">{{ month.month|date:"M Y" }}</td>
                <td style="border: 1px solid #ddd; padding: 8px;">{{ month.orders }}</td>
                <td style="border: 1px solid #ddd; padding: 8px;">PHP {{ month.revenue|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Pass data to JS
    window.topProductsLabels = [
        {% for product in top_products %}'{{ product.product__name }}'{% if not forloop.last %},{% endif %}{% endfor %}
    ];
    window.topProductsData = [
        {% for product in top_products %}{{ product.total_sold }}{% if not forloop.last %},{% endif %}{% endfor %}
    ];
</script>
<script src="{% static 'shop/scripts/pages/admin/admin.js' %}"></script>

{% endblock %}